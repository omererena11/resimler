<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>Pinch Probe</title>
<style>
  html,body{margin:0;height:100%;background:#000;overflow:hidden}
  #wrap{position:fixed;inset:0;touch-action:none;background:#000;display:flex;justify-content:center;align-items:center}
  #img{max-width:100%;max-height:100%;object-fit:contain;will-change:transform;transform-origin:center center}
  #hud{position:fixed;left:8px;bottom:8px;color:#9ad;background:#111a;padding:6px 8px;border-radius:8px;font:14px system-ui}
</style>
</head>
<body>
<div id="wrap">
  <!-- CORS derdini elemek için data URL de koyabilirsin; şimdilik HTTPS placeholder -->
  <img id="img" src="https://via.placeholder.com/1200x1800?text=PINCH+ME">
</div>
<div id="hud">scale: 1.00</div>

<script>
(function(){
  const wrap = document.getElementById('wrap');
  const img  = document.getElementById('img');
  const hud  = document.getElementById('hud');

  const clamp = (n,a,b)=>Math.max(a,Math.min(b,n));
  let scale=1, tx=0, ty=0, dragging=false, lx=0, ly=0;
  let baseDist=0, pinching=false, lastDist=null, cx=0, cy=0;

  function apply(){ img.style.transform = `translate(${tx}px,${ty}px) scale(${scale})`; hud.textContent = `scale: ${scale.toFixed(2)}`; }
  function clampPan(){
    const r = wrap.getBoundingClientRect();
    const extraX = (scale-1)*(r.width/2);
    const extraY = (scale-1)*(r.height/2);
    tx = clamp(tx, -extraX, extraX);
    ty = clamp(ty, -extraY, extraY);
  }

  wrap.addEventListener('touchstart', (e)=>{
    if(e.touches.length===2){
      const [t0,t1]=[e.touches[0],e.touches[1]];
      baseDist = Math.hypot(t1.clientX-t0.clientX, t1.clientY-t0.clientY);
      pinching=false; lastDist=null;
      e.preventDefault();
    }else if(e.touches.length===1 && scale>1){
      const t=e.touches[0]; dragging=true; lx=t.clientX; ly=t.clientY; e.preventDefault();
    }
  }, {passive:false});

  wrap.addEventListener('touchmove', (e)=>{
    if(e.touches.length===2){
      const [t0,t1]=[e.touches[0],e.touches[1]];
      const dist=Math.hypot(t1.clientX-t0.clientX, t1.clientY-t0.clientY);
      const deltaAbs=Math.abs(dist-baseDist);
      if(!pinching){
        if(deltaAbs>=16){
          pinching=true; lastDist=dist;
          const r=wrap.getBoundingClientRect();
          cx=(t0.clientX+t1.clientX)/2 - r.left - r.width/2 + tx;
          cy=(t0.clientY+t1.clientY)/2 - r.top  - r.height/2 + ty;
        } else { e.preventDefault(); return; }
      }
      const delta=dist-(lastDist??dist); lastDist=dist;
      const isOut = delta<0;
      const divisor = isOut ? 480 : 340; // out daha yumuşak
      const cap     = isOut ? 0.08 : 0.12;
      const raw = 1 + (delta/divisor);
      const factor = Math.min(Math.max(raw, 1-cap), 1+cap);
      const next = clamp(scale*factor, 1, 4);
      if(next!==scale){
        tx = cx - (cx - tx) * (next/scale);
        ty = cy - (cy - ty) * (next/scale);
        scale = next; clampPan(); apply();
      }
      e.preventDefault();
      return;
    }

    if(e.touches.length===1 && dragging && scale>1){
      const t=e.touches[0];
      tx += (t.clientX-lx); ty += (t.clientY-ly);
      lx=t.clientX; ly=t.clientY;
      clampPan(); apply();
      e.preventDefault();
    }
  }, {passive:false});

  wrap.addEventListener('touchend', ()=>{
    dragging=false; pinching=false; lastDist=null;
    if(scale<=1.0001){ scale=1; tx=0; ty=0; apply(); }
  }, {passive:true});
  wrap.addEventListener('touchcancel', ()=>{
    dragging=false; pinching=false; lastDist=null;
    if(scale<=1.0001){ scale=1; tx=0; ty=0; apply(); }
  }, {passive:true});

  // ilk çizim
  apply();
})();
</script>
</body>
</html>
